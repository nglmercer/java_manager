import{serverapi as p}from"./fetchapi.CXYT3pXQ.js";import{s as g,t as h}from"./globalSignals.Dr5Ywe9p.js";import"./CInput.DYPlFd8_.js";import{e as a}from"./Emitter.BIRpGEY5.js";import"./lit-element.CdPzzhzS.js";import"./lit-html.Cs9YtZST.js";import"./property.a2FlD-39.js";import"./state.Dj2gG79p.js";import"./map.DiiNQ3pp.js";const E=["-XX:+UseG1GC","-XX:MaxGCPauseMillis=200","-XX:G1HeapRegionSize=4M","-XX:InitiatingHeapOccupancyPercent=35","-XX:+ParallelRefProcEnabled","-XX:+PerfDisableSharedMem","-XX:+UseStringDeduplication"].join(` \\
`),v=32,N=document.querySelector("#add-optiflags")?.checked;function y(o=v,e=N){let t=`-Xmx${o*1024}M `;return e&&(t+=`${E}`),t}class D{constructor(){this.registeredNotifications=new Map,this.pendingRequests=new Map,this.setupGlobalListeners()}setupGlobalListeners(){a.on("notification:api-ready",e=>{typeof e=="object"&&e.id&&e.api&&this.registerNotification(e.id,e.api)}),a.on("notification:request-api",e=>{typeof e=="object"&&e.id&&typeof e.callback=="function"&&this.getNotificationApi(e.id,e.callback)})}registerNotification(e,t){this.registeredNotifications.set(e,t);const n=this.pendingRequests.get(e);n&&(n.forEach(i=>i(t)),this.pendingRequests.delete(e)),console.log(`NotificationEmitterManager: API registrada para '${e}'`)}getNotificationApi(e,t){const n=this.registeredNotifications.get(e);n?t(n):(this.pendingRequests.has(e)||this.pendingRequests.set(e,[]),this.pendingRequests.get(e).push(t),a.emit(`notification:get-api:${e}`,t))}async getNotifierApi(e){return new Promise((t,n)=>{let i=0;const s=50,u=()=>{const f=this.registeredNotifications.get(e);f?t(f):i++>s?n(new Error(`API para el notificador con ID '${e}' no encontrada tras ${s} intentos.`)):(this.getNotificationApi(e,d=>{t(d)}),setTimeout(u,100))};u()})}async showDialogWithMessage(e,t,n){try{const i=await this.getNotifierApi(e);if(!i){console.error(`La API de notificación '${e}' no está disponible`);return}if(await t(i),n){const s=document.querySelector(n);s&&typeof s.show=="function"&&s.show()}}catch(i){console.error("Error al mostrar diálogo con mensaje:",i)}}unregisterNotification(e){this.registeredNotifications.delete(e),this.pendingRequests.delete(e),console.log(`NotificationEmitterManager: API removida para '${e}'`)}getRegisteredNotifications(){return Array.from(this.registeredNotifications.keys())}clear(){this.registeredNotifications.clear(),this.pendingRequests.clear()}}const b=new D;async function I(o,e,t){return b.showDialogWithMessage(o,e,t)}const m=["serverName","selecttab","coreName","coreVersion","fileName","javaVersion","Ramsize","serverPort","optiflags"];document.querySelector("task-notifications");const r={};function l(o,e){r[o]=e}function w(o,e){o.addEventListener("change",t=>{const i=t.detail;if(console.log(`Campo ${e} cambió:`,i),!i?.value){console.warn(`Valor vacío o inválido para el campo: ${e}`);return}l(e,i.value)})}function M(o){const e=document.getElementById(o);return e?e.shadowRoot?.querySelector("input")?.files?.[0]||null:(console.error(`Elemento con ID '${o}' no encontrado`),null)}function R(){m.forEach(o=>{const e=document.getElementById(o);if(!e){console.warn(`Elemento con ID '${o}' no encontrado`);return}"value"in e&&e.value!==void 0&&l(o,e.value),w(e,o)})}R();function S(){m.forEach(o=>{const e=document.getElementById(o);if(!e){console.warn(`Elemento con ID '${o}' no encontrado durante la actualización`);return}"value"in e&&e.value!==void 0&&l(o,e.value)})}function A(){S(),r.startParameters=y(Number(r.Ramsize),r.optiflags),console.log("Datos del formulario preparados:",r);const o=new FormData;o.append("jsonData",JSON.stringify(r));const e=M("fileName");return e&&h.value.index===1&&(o.append("file",e),console.log("Archivo añadido al formulario:",e.name)),o}function X(o){if(o?.success){const e=o.message||"La operación fue un éxito rotundo.";c(t=>{t.setType("success",e,"Creando Server!")})}else{const e=`Error al enviar el formulario: ${o?.error||"Error desconocido"}`;c(t=>{t.setType("error",e,"Error")})}}async function $(o){try{const e=A();console.log("Enviando datos al servidor...");const t=await p.postNewserver(e);console.log("Respuesta del servidor:",t),X(t)}catch(e){console.error("Error durante el envío del formulario:",e),c(t=>{t.setType("error",`Error inesperado: ${e instanceof Error?e.message:"Error desconocido"}`,"Error de Conexión")})}}document.addEventListener("formSubmit",$);function C(o,e){const{index:t}=o;if(console.log("Cambio de pestaña detectado:",{value:o,oldValue:e,currentFormData:r}),t===1){const n=document.getElementById("coreVersion");n&&(console.log("Limpiando versión del core para pestaña de archivo"),"Values"in n&&(n.Values=null),r.coreVersion=void 0)}}g.subscribe("tabs",C);document.getElementById("notificationDialog");async function c(o){const e="notificationContent",t="#notificationDialog";try{await I(e,o,t)}catch(n){console.error("Error al mostrar el diálogo de notificación:",n)}}document.addEventListener("DOMContentLoaded",()=>{});
