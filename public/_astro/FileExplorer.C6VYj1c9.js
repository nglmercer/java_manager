import{e as g}from"./Emitter.BIRpGEY5.js";import{filemanagerapi as Z}from"./fetchapi.CXYT3pXQ.js";import{n as P,R as E,D as ee}from"./pathUtils.CXuP45Gi.js";/* empty css                                                                      */import{_ as q}from"./_plugin-vue_export-helper.DlAUqK2U.js";import{d as J,c as k,i as S,a as p,F as W,r as Q,e as Y,n as j,t as x,g as B,f as D,o as X,h as H,I as L,j as te,M as ae,k as re}from"./runtime-core.esm-bundler.D2uX_WMQ.js";const K="/",oe=J({__name:"PathNavigator",props:{basePath:{default:typeof window<"u"?window.selectedServer:""},currentPath:{default:typeof window<"u"?window.selectedServer:"/"}},setup(M,{expose:m}){m();const _=M,a=B(()=>{let o=_.basePath;(!o||o===E)&&(o=K);const l=P(o);if(l===E&&o!==E){const i=P(K);return i===E&&i!==E&&console.error("Critical: DEFAULT_SERVER_NAME_IF_EMPTY results in ROOT_PATH. Check configuration."),i}return l}),n=D(_.currentPath||a.value),y=B(()=>{const o=n.value,l=a.value,i=[];ee.setPath(o);const u=P(o),d=P(l);if(u===d){const v=d.split("/").filter(T=>T.length>0).pop()||"/";return i.push({name:v,path:d}),i}if(!u.startsWith(d)){const v=d.split("/").filter(T=>T.length>0).pop()||"/";return i.push({name:v,path:d}),i}const I=u.slice(d.length).split("/").filter(v=>v.length>0),A=d.split("/").filter(v=>v.length>0).pop()||"/";i.push({name:A,path:d});let N=d;for(const v of I)N=`${N}/${v}`,i.push({name:v,path:N});return i});let r=null;X(()=>{r=g.on("path-navigator:update-path",o=>{const l=P(o.path),i=a.value,u=l.startsWith(i)&&l.length>=i.length?l:i;n.value!==u&&(n.value=u)})}),H(()=>{r&&r()}),L(a,o=>{const l=n.value;(!l.startsWith(o)||l.length<o.length)&&(n.value=o,g.emit("path-navigator:path-changed",{path:o}))}),g.on("path-navigator:get-current-path",()=>{g.emit("path-navigator:current-path",{path:n.value})}),L(()=>_.currentPath,o=>{o&&o!==n.value&&(n.value=o)});const U={props:_,DEFAULT_SERVER_NAME_IF_EMPTY:K,effectiveBasePath:a,currentPath:n,pathSegments:y,get unsubscribePathUpdate(){return r},set unsubscribePathUpdate(o){r=o},goUp:()=>{const o=n.value,l=a.value;if(o===l)return;const i=o.split("/").filter($=>$.length>0);i.pop();let u=`${E}${i.join("/")}`;u=P(u);const d=!u.startsWith(l)||u.length<l.length?l:u;n.value!==d&&(n.value=d,g.emit("path-navigator:path-changed",{path:d}))},navigateToPath:o=>{const l=P(o),i=a.value,u=n.value,d=l.startsWith(i)&&l.length>=i.length?l:i;console.log("navigateToPath",{from:u,to:d,clicked:o}),n.value!==d&&(n.value=d,g.emit("path-navigator:path-changed",{path:d}),g.emit("path-navigator:navigate",{from:u,to:d,trigger:"segment-click"}))},goToBase:()=>{const o=a.value,l=n.value;console.log("goToBase",{basePath:o,currentPath:l}),n.value!==o&&(n.value=o,g.emit("path-navigator:path-changed",{path:o}),g.emit("path-navigator:navigate",{from:l,to:o,trigger:"base-button"}))},refreshCurrentPath:()=>{g.emit("path-navigator:refresh-requested",{path:n.value}),g.emit("file-explorer:refresh-data",{path:n.value})}};return Object.defineProperty(U,"__isScriptSetup",{enumerable:!1,value:!0}),U}}),ne={class:"path-navigator"},se={class:"flex items-center flex-wrap"},ie=["onClick","title"],le={key:0,class:"path-separator"},ce={class:"flex items-center gap-2"};function de(M,m,_,a,n,y){return S(),k("div",ne,[p("div",se,[(S(!0),k(W,null,Q(a.pathSegments,(r,h)=>(S(),k(W,{key:r.path},[p("span",{class:j(["path-segment",r.path!==a.currentPath?"path-segment-clickable":"path-segment-current"]),onClick:w=>r.path!==a.currentPath&&a.navigateToPath(r.path),title:`Navigate to ${r.path}`},x(r.name),11,ie),h<a.pathSegments.length-1?(S(),k("span",le," / ")):Y("",!0)],64))),128))]),p("div",ce,[p("button",{onClick:a.goToBase,class:"base-button",title:"Go to base directory"}," / "),a.currentPath!==a.effectiveBasePath?(S(),k("button",{key:0,onClick:a.goUp,class:"up-button",title:"Go up one level"}," ↑ Up ")):Y("",!0),p("button",{onClick:a.refreshCurrentPath,class:"refresh-button",title:"Refresh current directory"}," ↻ Refresh ")])])}const he=q(oe,[["render",de],["__scopeId","data-v-cf3b5863"]]),pe=J({__name:"FileExplorer",props:{id:{},currentPath:{default:"/"},basePath:{default:typeof window<"u"&&window.selectedServer||"/"},data:{default:()=>[]}},emits:["selected","menu","updated","sort"],setup(M,{expose:m,emit:_}){m();const a=M,n=D(a.currentPath),y=D([...a.data]),r=_,h=g,w=D("name"),F=D("asc"),O=D({name:"↕️",path:"↕️",size:"↕️",lastModified:"↕️"}),U=n,o=y,l=B(()=>P(n.value)),i=B(()=>(y.value||[]).map(e=>({...e,name:e.name||"Unnamed",path:P(e.path),type:e.type||(e.isDirectory?"directory":"file"),lastModified:e.lastModified||e.modified||new Date().toISOString(),size:e.size===void 0&&(e.type==="file"||!e.isDirectory&&!e.type)?0:e.size}))),u=B(()=>[...i.value].sort((t,s)=>{let f,b;switch(w.value){case"name":f=t.name.toLowerCase(),b=s.name.toLowerCase();break;case"path":f=t.path.toLowerCase(),b=s.path.toLowerCase();break;case"size":if(t.type==="directory"&&s.type!=="directory")return-1;if(t.type!=="directory"&&s.type==="directory")return 1;f=t.size||0,b=s.size||0;break;case"lastModified":f=new Date(t.lastModified||t.modified||"").getTime(),b=new Date(s.lastModified||s.modified||"").getTime();break;default:f=t.name.toLowerCase(),b=s.name.toLowerCase()}return F.value==="asc"?f>b?1:f<b?-1:0:f<b?1:f>b?-1:0}));function d(e){if(e==null||isNaN(e))return"-";if(e===0)return"0 Bytes";const t=1024,s=["Bytes","KB","MB","GB","TB"],f=Math.floor(Math.log(e)/Math.log(t));return parseFloat((e/Math.pow(t,f)).toFixed(2))+" "+s[f]}function $(e){if(!e)return"-";try{const t=new Date(e);if(isNaN(t.getTime()))return"-";const s=t.getFullYear(),f=String(t.getMonth()+1).padStart(2,"0"),b=String(t.getDate()).padStart(2,"0"),z=String(t.getHours()).padStart(2,"0"),c=String(t.getMinutes()).padStart(2,"0");return`${s}-${f}-${b} ${z}:${c}`}catch{return"-"}}async function I(e){if(e.type==="directory")await v(e.path);else{const t=e;r("selected",{data:t}),h.emit("file-explorer:selected",{data:t})}}function A(e,t){e.preventDefault();const s=t;r("menu",{event:e,data:s}),h.emit("file-explorer:menu",{event:e,data:s})}function N(e,t){(e.key==="Enter"||e.key===" ")&&I(t)}async function v(e){try{console.log(`Navigating to directory: ${e}`);const t=P(e);n.value=t,g.emit("path-navigator:update-path",{path:t});const s=await R(t);s?.files?(y.value=s.files,console.log(`Loaded ${s.files.length} items for path: ${t}`)):(console.warn(`No files found for path: ${t}`),y.value=[]),r("updated",{path:t}),console.log("normalizedPath",t),h.emit("file-explorer:path-updated",{path:t}),h.emit("file-explorer:data-updated",{data:s?.files||[]}),await ae()}catch(t){console.error("Error navigating to directory:",t);const s=P(e);r("updated",{path:s}),h.emit("file-explorer:navigation-error",{path:s,error:t})}}function T(e){w.value===e?F.value=F.value==="asc"?"desc":"asc":(w.value=e,F.value="asc"),V(),r("sort",{column:w.value,direction:F.value}),h.emit("file-explorer:sort",{column:w.value,direction:F.value})}function V(){const e={name:"↕️",path:"↕️",size:"↕️",lastModified:"↕️"};e[w.value]=F.value==="asc"?"⬆️":"⬇️",O.value=e}L(()=>a.currentPath,e=>{n.value=e;const t=P(e);console.log("normalizedPath",t),r("updated",{path:t}),h.emit("file-explorer:path-updated",{path:t})}),L(()=>a.data,e=>{y.value=[...e||[]],h.emit("file-explorer:data-updated",{data:e})},{deep:!0}),X(async()=>{V();const e=g.on("path-navigator:path-changed",c=>{c.path!==n.value&&v(c.path)}),t=g.on("path-navigator:navigate",c=>{console.log(`Navigation triggered by ${c.trigger}: ${c.from} -> ${c.to}`),c.to!==n.value&&v(c.to)}),s=g.on("file-explorer:refresh-data",async c=>{console.log(`Refreshing data for path: ${c.path}`);try{const C=await R(c.path);C?.files&&(y.value=C.files,h.emit("file-explorer:data-updated",{data:C.files}))}catch(C){console.error("Error refreshing directory data:",C)}});H(()=>{e(),t(),s()});const f=c=>{c.detail&&(c.detail.currentPath&&(n.value=c.detail.currentPath),c.detail.data&&(y.value=[...c.detail.data]),r("updated",{path:c.detail.currentPath||"/"}),h.emit("file-explorer:external-update",{currentPath:c.detail.currentPath||"/",data:c.detail.data}))};(async c=>{const C=await R(window.selectedServer);y.value=C?.files||[]})();const z=document.getElementById("filemanager");z&&z.addEventListener("update-files",f),H(()=>{z&&z.removeEventListener("update-files",f)})});async function R(e=window.selectedServer){if(e==="/")return;const t=encodeURIComponent(e),s=await Z.getFolderInfo(t);return console.log("result",s),s.data}const G={props:a,internalCurrentPath:n,internalData:y,emit:r,fileExplorerEmitter:h,sortColumn:w,sortDirection:F,headerIcons:O,currentPath:U,data:o,normalizedCurrentPath:l,processedData:i,sortedData:u,formatFileSize:d,formatDate:$,handleDblClick:I,handleContextMenu:A,handleKeydown:N,navigateToDirectory:v,handleSort:T,updateHeaderIcons:V,fetchFiles:R,PathNavigator:he};return Object.defineProperty(G,"__isScriptSetup",{enumerable:!1,value:!0}),G}}),ue={class:"block font-sans text-gray-300 bg-gray-800 border border-gray-600 border-opacity-50"},fe={class:"w-full border-collapse"},ge=["aria-label","onDblclick","onContextmenu","onKeydown"],ve={class:"px-3 py-2"},me={class:"px-3 py-2"},ye={class:"px-3 py-2"},be={class:"px-3 py-2"};function Pe(M,m,_,a,n,y){return S(),k("div",ue,[te(a.PathNavigator,{basePath:_.basePath,currentPath:a.internalCurrentPath},null,8,["basePath","currentPath"]),p("table",fe,[p("thead",null,[p("tr",null,[p("th",{onClick:m[0]||(m[0]=r=>a.handleSort("name")),class:"bg-gray-700 text-gray-200 sticky top-0 z-10 px-3 py-2 text-left border-b border-gray-600 border-opacity-50 whitespace-nowrap overflow-hidden text-ellipsis cursor-pointer hover:bg-gray-600"}," Name "+x(a.headerIcons.name),1),p("th",{onClick:m[1]||(m[1]=r=>a.handleSort("path")),class:"bg-gray-700 text-gray-200 sticky top-0 z-10 px-3 py-2 text-left border-b border-gray-600 border-opacity-50 whitespace-nowrap overflow-hidden text-ellipsis cursor-pointer hover:bg-gray-600"}," Path "+x(a.headerIcons.path),1),p("th",{onClick:m[2]||(m[2]=r=>a.handleSort("size")),class:"bg-gray-700 text-gray-200 sticky top-0 z-10 px-3 py-2 text-left border-b border-gray-600 border-opacity-50 whitespace-nowrap overflow-hidden text-ellipsis cursor-pointer hover:bg-gray-600"}," Size "+x(a.headerIcons.size),1),p("th",{onClick:m[3]||(m[3]=r=>a.handleSort("lastModified")),class:"bg-gray-700 text-gray-200 sticky top-0 z-10 px-3 py-2 text-left border-b border-gray-600 border-opacity-50 whitespace-nowrap overflow-hidden text-ellipsis cursor-pointer hover:bg-gray-600"}," Modified "+x(a.headerIcons.lastModified),1)])]),p("tbody",null,[(S(!0),k(W,null,Q(a.sortedData,r=>(S(),k("tr",{key:r.path,class:j([r.type,"px-3 py-2 text-left border-b border-gray-600 border-opacity-50 whitespace-nowrap overflow-hidden text-ellipsis hover:bg-gray-700 cursor-pointer"]),tabindex:"0","aria-label":`File ${r.name}, type ${r.type}`,onDblclick:h=>a.handleDblClick(r),onContextmenu:h=>a.handleContextMenu(h,r),onKeydown:h=>a.handleKeydown(h,r)},[p("td",ve,[p("span",{class:j(["inline-block w-5 h-5 mr-2 align-middle",r.type==="directory"?"text-blue-400":"text-gray-400"])},x(r.type==="directory"?"📁":"📄"),3),re(" "+x(r.name),1)]),p("td",me,x(r.path),1),p("td",ye,x(r.type==="directory"?"-":a.formatFileSize(r.size)),1),p("td",be,x(a.formatDate(r.lastModified)),1)],42,ge))),128))])])])}const Ce=q(pe,[["render",Pe]]);export{Ce as default};
