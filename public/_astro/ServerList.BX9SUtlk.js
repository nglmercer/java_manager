import{f as C,g as _,d as A,c as g,i as w,a as d,t as x,K as O,n as j,e as k,F as D,r as N,o as F,j as B,L as q}from"./runtime-core.esm-bundler.D2uX_WMQ.js";import{_ as L}from"./_plugin-vue_export-helper.DlAUqK2U.js";import{e as z}from"./Emitter.BIRpGEY5.js";/* empty css                                     */const R="modulepreload",U=function(c){return"/"+c},P={},V=function(o,a,e){let m=Promise.resolve();if(a&&a.length>0){let r=function(i){return Promise.all(i.map(t=>Promise.resolve(t).then(n=>({status:"fulfilled",value:n}),n=>({status:"rejected",reason:n}))))};document.getElementsByTagName("link");const l=document.querySelector("meta[property=csp-nonce]"),h=l?.nonce||l?.getAttribute("nonce");m=r(a.map(i=>{if(i=U(i),i in P)return;P[i]=!0;const t=i.endsWith(".css"),n=t?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${i}"]${n}`))return;const s=document.createElement("link");if(s.rel=t?"stylesheet":R,t||(s.as="script"),s.crossOrigin="",s.href=i,h&&s.setAttribute("nonce",h),document.head.appendChild(s),t)return new Promise((v,S)=>{s.addEventListener("load",v),s.addEventListener("error",()=>S(new Error(`Unable to preload CSS for ${i}`)))})}))}function p(r){const l=new Event("vite:preloadError",{cancelable:!0});if(l.payload=r,window.dispatchEvent(l),!l.defaultPrevented)throw r}return m.then(r=>{for(const l of r||[])l.status==="rejected"&&p(l.reason);return o().catch(p)})},M=C([]),I=C(!1),E=C(null),b=C(null);function $(){let c=null;const o=async()=>{try{const{serverapi:t}=await V(async()=>{const{serverapi:n}=await import("./fetchapi.CXYT3pXQ.js");return{serverapi:n}},[]);return c=t,!0}catch(t){return console.error("Failed to load serverapi:",t),!1}},a=async()=>{if(!c&&!await o())throw new Error("Failed to initialize server API");I.value=!0,E.value=null;try{const t=await c.getServers();if(!t||!t.data||!Array.isArray(t.data))throw new Error("Invalid response format");const n=t.data.map(s=>({id:s.name,name:s.name,size:s.size||0,lastModified:s.lastModified||s.modified,status:s.status||"stopped",version:s.version||"N/A",icon:s.icon}));return M.value=n,n}catch(t){const n=t instanceof Error?t.message:"Failed to load servers";throw E.value=n,console.error("Error fetching servers:",t),t}finally{I.value=!1}},e=t=>M.value.find(n=>n.id===t),m=t=>{b.value=t},p=_(()=>b.value?e(b.value):null),r=async()=>await a(),l=async t=>{c||await o(),console.log("Starting server:",t)},h=async t=>{c||await o(),console.log("Stopping server:",t)},i=async t=>{c||await o(),console.log("Restarting server:",t)};return{servers:_(()=>M.value),loading:_(()=>I.value),error:_(()=>E.value),activeServerId:_(()=>b.value),activeServer:p,fetchServers:a,refreshServers:r,getServerById:e,setActiveServer:m,startServer:l,stopServer:h,restartServer:i,initializeApi:o}}const T=A({__name:"ServerItem",props:{server:{default:null},size:{default:0},version:{default:"Unknown"},modified:{default:null},status:{default:null},icon:{default:null},title:{default:""},active:{type:Boolean,default:!1}},emits:["selected","menu"],setup(c,{expose:o,emit:a}){const e=c,m=a,p=_(()=>e.title?e.title.replace(/\s+/g,"-").toLowerCase():""),r=_(()=>{if(!e.size)return"0 B";const v=["B","KB","MB","GB","TB"],S=Math.floor(Math.log(e.size)/Math.log(1024));return`${(e.size/Math.pow(1024,S)).toFixed(2)} ${v[S]}`}),l=_(()=>{if(!e.modified)return"";try{return new Date(e.modified).toLocaleDateString()}catch{return""}}),h=()=>({server:e.server,size:e.size,modified:e.modified,version:e.version,status:e.status,title:e.title,icon:e.icon}),i=v=>{console.log("setActive called with:",v)},t=v=>{const S=v.composedPath(),y=document.querySelector(`#server-actions-${p.value}`);y&&S.includes(y)||m("selected",{data:h(),event:v})},n=v=>{v.preventDefault(),m("menu",{data:h(),event:v})};o({getDetails:h,setActive:i});const s={props:e,emit:m,serverId:p,formattedSize:r,formattedDate:l,getDetails:h,setActive:i,handleClick:t,handleContextMenu:n};return Object.defineProperty(s,"__isScriptSetup",{enumerable:!1,value:!0}),s}}),K=["id"],G={class:"flex items-center justify-center w-8 h-8 rounded-full bg-blue-500 mr-4 flex-shrink-0 transition-colors duration-200"},W=["src","alt"],H={class:"flex flex-col flex-grow overflow-hidden"},J={class:"font-medium whitespace-nowrap overflow-hidden text-ellipsis"},Q={class:"text-xs opacity-70 whitespace-nowrap overflow-hidden text-ellipsis"},X=["id"],Y={class:"w-full"};function Z(c,o,a,e,m,p){return w(),g("div",{class:j(["flex items-center p-2 mb-2 rounded-lg transition-all duration-200 cursor-pointer select-none",a.active?"bg-blue-500/50 text-white":"hover:bg-blue-500/10"]),id:`server-${e.serverId}`,onClick:e.handleClick,onContextmenu:e.handleContextMenu},[d("div",G,[d("img",{src:a.icon||"/favicon.svg",alt:a.title||"",class:"w-5 h-5 object-contain brightness-0 invert"},null,8,W)]),d("div",H,[d("span",J,x(a.title||""),1),d("span",Q," Size: "+x(e.formattedSize)+" | Modified: "+x(e.formattedDate)+" | v"+x(a.version),1)]),d("div",{class:"ml-auto flex items-center",id:`server-actions-${e.serverId}`},[d("div",Y,[O(c.$slots,"default")])],8,X)],42,K)}const ee=L(T,[["render",Z]]),te=A({__name:"ServerList",emits:["server-selected","server-menu","server-options"],setup(c,{expose:o,emit:a}){o();const e=a,m=A({props:{status:{type:String,required:!0}},setup(u){return{getColorClass:_(()=>{switch(u.status){case"running":return"bg-green-500";case"stopped":return"bg-red-500";case"starting":return"bg-yellow-500";default:return"bg-gray-500"}})}},template:`
    <div 
      :class="'w-3 h-3 rounded-full mr-2 ' + getColorClass"
      :title="status"
    ></div>
  `}),{servers:p,loading:r,error:l,activeServerId:h,fetchServers:i,setActiveServer:t,getServerById:n}=$();F(async()=>{await i()});const y={emit:e,StatusIndicator:m,servers:p,loading:r,error:l,activeServerId:h,fetchServers:i,setActiveServer:t,getServerById:n,handleServerSelected:u=>{const f=n(u.data.server||"");f&&(t(f.id),e("server-selected",f),console.log("handleServerSelected",f),z.emit("server-selected",f),window.location.href="/console/?server="+f.id,console.log("Server selected:",f.id))},handleServerMenu:u=>{const f=n(u.data.server||"");f&&u.event&&(console.log("handleServerMenu",f,u.event),e("server-menu",f,u.event),z.emit("server-menu",{server:f,event:u.event}))},openServerOptions:u=>{e("server-options",u),console.log("openServerOptions",u),z.emit("server-options",u)},ServerItem:ee};return Object.defineProperty(y,"__isScriptSetup",{enumerable:!1,value:!0}),y}}),re={class:"servers-container space-y-2"},se={key:0,class:"p-4"},ne={key:1,class:"p-4"},oe={class:"error-text"},ie={key:2,class:"p-4"},ae={class:"p-4"},le={class:"flex items-center justify-between w-full"},ce={class:"flex items-center"},de=["onClick"];function ue(c,o,a,e,m,p){return w(),g("div",re,[e.loading?(w(),g("div",se,o[0]||(o[0]=[d("p",{class:"loading-text"},"Loading servers...",-1)]))):k("",!0),e.error?(w(),g("div",ne,[d("p",oe,x(e.error),1)])):k("",!0),!e.loading&&!e.error&&e.servers.length===0?(w(),g("div",ie,o[1]||(o[1]=[d("p",{class:"empty-text"},"No servers found.",-1)]))):k("",!0),(w(!0),g(D,null,N(e.servers,r=>(w(),g("div",{key:r.id,class:"server-card"},[d("div",ae,[B(e.ServerItem,{icon:r.icon||"/favicon.svg",title:r.name,size:r.size,version:r.version,modified:r.lastModified,server:r.id,status:r.status,active:e.activeServerId===r.id,onSelected:e.handleServerSelected,onMenu:e.handleServerMenu},{default:q(()=>[d("div",le,[d("div",ce,[B(e.StatusIndicator,{status:r.status},null,8,["status"])]),d("button",{class:"server-options-btn",onClick:l=>e.openServerOptions(r)},o[2]||(o[2]=[d("span",{class:"material-symbols-rounded server-options-icon"},"more_vert",-1)]),8,de)])]),_:2},1032,["icon","title","size","version","modified","server","status","active"])])]))),128))])}const he=L(te,[["render",ue],["__scopeId","data-v-2ffbcfc2"]]);export{he as S,$ as u};
