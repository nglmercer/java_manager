import{a as S}from"./runtime-dom.esm-bundler.8y5z4vCJ.js";import{e as p}from"./Emitter.BIRpGEY5.js";import{_ as H}from"./_plugin-vue_export-helper.DlAUqK2U.js";import{d as K,c as y,e as P,F as V,r as A,n as W,b as $,f as r,g as O,I as j,o as D,h as T,M as B,i as k}from"./runtime-core.esm-bundler.D2uX_WMQ.js";const I=K({__name:"CPopup",props:{id:{},customClass:{},trapFocus:{type:Boolean}},setup(_,{expose:b}){b();const l=_,o=r(!1),d=r(0),m=r(0),c=r([]),n=r(null),a=r(null),M=O(()=>({left:`${d.value}px`,top:`${m.value}px`})),R=O(()=>["fixed z-50 flex flex-col bg-white border border-gray-200 rounded-md shadow-lg min-w-[180px] py-1",l.customClass||""]),x=async(e,t)=>{if(await B(),!n.value)return;const s=n.value.getBoundingClientRect(),F=window.innerWidth,z=window.innerHeight;e+s.width>F-10?e=F-s.width-10:e<10&&(e=10),t+s.height>z-10&&(t=t-s.height-s.top+10,t<10&&(t=z-s.height-10)),d.value=e,m.value=Math.max(10,t)},h=e=>{o.value=!0,e&&x(e.x,e.y),B(()=>{l.trapFocus&&n.value&&n.value.focus()}),document.addEventListener("click",v,{capture:!0}),document.addEventListener("keydown",f)},u=()=>{o.value=!1,a.value?.focus(),a.value=null,document.removeEventListener("click",v),document.removeEventListener("keydown",f)},w=e=>{const t=e.getBoundingClientRect();a.value=e,h({x:t.left,y:t.bottom})},E=e=>{c.value=e.map(t=>({html:t.html,callback:s=>{t.callback(s),u()}}))},C=()=>{c.value=[]},v=e=>{if(!n.value)return;const t=e.composedPath();!t.includes(n.value)&&(!a.value||!t.includes(a.value))&&u()},f=e=>{e.key==="Escape"&&u()};j(o,e=>{if(e&&l.trapFocus){const t=s=>{n.value&&!n.value.contains(s.relatedTarget)&&n.value.focus()};document.addEventListener("focusout",t),T(()=>document.removeEventListener("focusout",t))}});let i=[];D(()=>{i.push(p.on("popup:show",e=>h(e))),i.push(p.on("popup:hide",()=>u())),i.push(p.on("popup:showAtElement",e=>w(e))),i.push(p.on("popup:setOptions",e=>E(e))),i.push(p.on("popup:clearOptions",()=>C())),window.addEventListener("resize",g)}),T(()=>{i.forEach(e=>e()),document.removeEventListener("click",v),document.removeEventListener("keydown",f),window.removeEventListener("resize",g)});const g=()=>{o.value&&a.value&&w(a.value)},L={props:l,isVisible:o,posX:d,posY:m,options:c,containerRef:n,lastFocusedElement:a,containerStyle:M,containerClasses:R,moveTo:x,show:h,hide:u,showAtElement:w,setOptions:E,clearOptions:C,handleClickOutside:v,handleKeyDown:f,get cleanupFunctions(){return i},set cleanupFunctions(e){i=e},handleResize:g};return Object.defineProperty(L,"__isScriptSetup",{enumerable:!1,value:!0}),L}}),N=["onClick","onKeydown","innerHTML"];function U(_,b,l,o,d,m){return o.isVisible?(k(),y("div",{key:0,ref:"containerRef",style:$(o.containerStyle),class:W(o.containerClasses),tabindex:"0",role:"menu","aria-orientation":"vertical"},[(k(!0),y(V,null,A(o.options,(c,n)=>(k(),y("div",{key:n,class:"px-4 py-2 text-sm text-gray-700 cursor-pointer hover:bg-gray-100 hover:text-gray-900",role:"menuitem",tabindex:"-1",onClick:c.callback,onKeydown:S(c.callback,["enter"]),innerHTML:c.html},null,40,N))),128))],6)):P("",!0)}const J=H(I,[["render",U]]);export{J as default};
