import{A as k}from"./barstatus.CzxN21Ca.js";import{filemanagerapi as s}from"./fetchapi.CXYT3pXQ.js";import{e as d}from"./Emitter.BIRpGEY5.js";import{D as O,n as B,a as I}from"./pathUtils.CXuP45Gi.js";/* empty css                                                                      */import"./custom-modal.Dpdsc3Kx.js";import"./CInput.DYPlFd8_.js";import{o as g}from"./dropdown.4676YYwp.js";import{s as m}from"./globalSignals.Dr5Ywe9p.js";import"./lit-element.CdPzzhzS.js";import"./lit-html.Cs9YtZST.js";import"./custom-element.BhZVzxrc.js";import"./property.a2FlD-39.js";import"./directive.CGE4aKEl.js";import"./state.Dj2gG79p.js";import"./map.DiiNQ3pp.js";const f=["selected","menu","updated","sort","file-explorer:selected","file-explorer:menu","file-explorer:path-updated","file-explorer:data-updated","file-explorer:navigation-error","file-explorer:sort","file-explorer:external-update","path-navigator:path-changed","path-navigator:navigate","file-explorer:refresh-data","path-navigator:update-path"],p=document.getElementById("file-Editor"),F=document.getElementById("upload-files"),E=document.getElementById("new-folder"),w=document.getElementById("EditFilename"),c=document.getElementById("FilenameEditor"),r=document.getElementById("OriginalFilename"),a=document.getElementById("file-name");document.addEventListener("DOMContentLoaded",function(){const n=document.getElementById("FileActions");if(!n||!(n instanceof k))return;L(),C(),P();const t=[{id:"new-file",label:"{{create}} {{file}}",icon:"add_circle",action:"new-file"},{id:"upload-file",label:"{{uploadFile}}",icon:"upload_file",action:"upload-file",iconOnly:!0},{id:"new-folder",label:"{{create}} {{folder}}",icon:"create_new_folder",action:"new-folder",iconOnly:!0},{id:"refresh-folder",label:"{{refresh}}",icon:"refresh",action:"refresh-folder",iconOnly:!0}];t.forEach(e=>{n.addButton(e)}),d.on(f[4],async({data:e})=>{if(console.log(f[4],e),e.type!=="directory"){const o=await D(e.path);if(typeof o!="string")return;console.log("fileData",o,typeof o),p.show(),m.set("fileEditor-content",o),a.value=e.path;return}}),d.on(f[5],({data:e,event:o})=>{console.log(f[5],e);const l=x(e);console.log("menu",{data:e,event:o}),d.emit("popup:setOptions",l),d.emit("popup:show",{x:o.clientX,y:o.clientY})}),n.addEventListener("button-clicked",e=>{if(!("detail"in e)||!(e instanceof CustomEvent))return;const o=t.find(l=>l.id===e.detail.id);if(console.log("isValidEvent",o),o)switch(e.detail.id){case t[0].id:p.show();break;case t[1].id:F.show(),console.log("uploadFiles",F);break;case t[2].id:E.show();break;case t[3].id:u();break;default:console.log("Button clicked:",e.detail,o);break}})});function _(n,t){const e=window.URL.createObjectURL(n),o=document.createElement("a");o.href=e,o.download=t,document.body.appendChild(o),o.click(),document.body.removeChild(o),window.URL.revokeObjectURL(e)}function u(){d.emit(f[13],{path:v()})}function v(n){const t=O.getPath();return B(window.selectedServer+t+"/"+(n||""))}async function D(n){const t=encodeURIComponent(n),e=await s.readFileByPath(t);return console.log("result",e),e?typeof e.data=="string"?e.data:e.data?.content:!1}function x(n){const t={html:g({id:"download-file",icon:"download",text:"Download File"}),callback:async function(){const i=await s.downloadFile(n.path);i instanceof Blob?_(i,n.name):console.log("result",i)}},e={html:g({id:"rename-file",icon:"bookmark_manager",text:"Rename File"}),callback:function(){w.show(),c.value=n.name,r.value=n.path,console.log("Option 2 clicked",c?.value,r?.value)}},o={html:g({id:"delete-file",icon:"delete",text:"Delete File"}),callback:async function(){if(n&&n.path){console.log("Option 3 clicked",n);const i=await s.deleteFile(window.selectedServer,n.path);if(!i)return;console.log("result",i),u()}}},l=[];return n.isDirectory||l.push(t),l.push(e),l.push(o),l}async function C(){const n=["save-file","cancel-file"],t={};n.forEach(e=>{const o=document.getElementById(e);o&&(t[e]=o,o.addEventListener("click",async l=>{if(console.log("MF_action",e),e==="save-file"){const i=m.get("fileEditor-content")?.value;if(!i)return;console.log("fileData",i,a.value);const{directoryname:y,filename:b}=I(window.selectedServer,a?.value),h=await s.writeFile({directoryname:y,filename:b,content:i});if(console.log("result",h),!h||typeof h.data>"u")return;p.hide(),a.value="",m.set("fileEditor-content",""),u()}e==="cancel-file"&&(p.hide(),a.value="",m.set("fileEditor-content",""),a.value="")}))}),console.log("MF_elements",t)}async function L(){["create-folder","cancel-folder"].forEach(t=>{const e=document.getElementById(t);e&&e.addEventListener("click",async o=>{console.log("CD_action",t);const l=document.getElementById("NewFolder");if(t==="create-folder"){if(console.log("InputFolder",l.value),!l)return;const i=await s.createFolder(v(l.value));if(!i)return;console.log("result",i),(i.success||i.data)&&u(),E.hide()}t==="cancel-folder"&&E.hide()})})}async function P(){["save-EditFilename","cancel-EditFilename"].forEach(t=>{const e=document.getElementById(t);e&&e.addEventListener("click",async o=>{if(console.log("EF_action",t,c?.value,r?.value),t==="save-EditFilename"){const l=await s.renameFile(window.selectedServer,r?.value,c?.value);if(!l)return;console.log("result",l),w.hide(),c.value="",r.value="",(l.success||l.data)&&u()}t==="cancel-EditFilename"&&(w.hide(),c.value="",r.value="")})})}
