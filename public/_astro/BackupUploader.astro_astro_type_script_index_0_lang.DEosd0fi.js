import{backupsapi as a}from"./fetchapi.CXYT3pXQ.js";import{g as l}from"./RecentBackups.astro_astro_type_script_index_0_lang.0yLp6_Cj.js";import"./lit-element.CdPzzhzS.js";import"./lit-html.Cs9YtZST.js";import"./custom-element.BhZVzxrc.js";import"./property.a2FlD-39.js";import"./directive.CGE4aKEl.js";import"./directive-helpers.CY_bUdrT.js";class o{constructor(){this.selectedFile=null,this.isLoading=!1,this.initializeElements(),this.attachEventListeners()}initializeElements(){this.dropzone=this.getElementById("dropzone"),this.fileInput=this.getElementById("fileInput"),this.selectFileBtn=this.getElementById("selectFileBtn"),this.fileInfo=this.getElementById("fileInfo"),this.fileName=this.getElementById("fileName"),this.fileSize=this.getElementById("fileSize"),this.removeFileBtn=this.getElementById("removeFileBtn"),this.uploadBtn=this.getElementById("uploadBtn"),this.uploadText=this.getElementById("uploadText"),this.uploadSpinner=this.getElementById("uploadSpinner"),this.messageContainer=this.getElementById("messageContainer"),this.message=this.getElementById("message")}getElementById(e){const t=document.getElementById(e);if(!t)throw new Error(`Element with id '${e}' not found`);return t}attachEventListeners(){this.dropzone.addEventListener("dragover",this.handleDragOver.bind(this)),this.dropzone.addEventListener("dragleave",this.handleDragLeave.bind(this)),this.dropzone.addEventListener("drop",this.handleDrop.bind(this)),this.dropzone.addEventListener("click",()=>this.fileInput.click()),this.selectFileBtn.addEventListener("click",e=>{e.stopPropagation(),this.fileInput.click()}),this.fileInput.addEventListener("change",this.handleFileSelect.bind(this)),this.removeFileBtn.addEventListener("click",this.removeFile.bind(this)),this.uploadBtn.addEventListener("click",this.handleUpload.bind(this))}handleDragOver(e){e.preventDefault(),this.dropzone.classList.add("drag-over")}handleDragLeave(e){e.preventDefault(),this.dropzone.contains(e.relatedTarget)||this.dropzone.classList.remove("drag-over")}handleDrop(e){e.preventDefault(),this.dropzone.classList.remove("drag-over");const t=e.dataTransfer?.files;t&&t.length>0&&this.processFile(t[0])}handleFileSelect(e){const i=e.target.files?.[0];i&&this.processFile(i)}processFile(e){const t=this.validateFile(e);if(!t.isValid){this.showMessage(t.errorMessage||"Archivo no válido","error");return}this.selectedFile=e,this.displayFileInfo(),this.hideMessage()}validateFile(e){return[".zip",".tar.gz"].some(n=>e.name.endsWith(n))?e.size>5368709120?{isValid:!1,errorMessage:"El archivo es demasiado grande. Máximo 2GB."}:{isValid:!0}:{isValid:!1,errorMessage:"Por favor, selecciona un archivo .zip o .tar.gz"}}displayFileInfo(){this.selectedFile&&(this.fileName.textContent=this.selectedFile.name,this.fileSize.textContent=this.formatFileSize(this.selectedFile.size),this.fileInfo.style.display="block",this.dropzone.style.display="none")}formatFileSize(e){if(e===0)return"0 Bytes";const t=1024,i=["Bytes","KB","MB","GB"],s=Math.floor(Math.log(e)/Math.log(t));return parseFloat((e/Math.pow(t,s)).toFixed(2))+" "+i[s]}removeFile(){this.selectedFile=null,this.fileInput.value="",this.fileInfo.style.display="none",this.dropzone.style.display="block",this.hideMessage()}async handleUpload(){if(!(!this.selectedFile||this.isLoading)){this.setLoading(!0),this.hideMessage();try{const e=await a.uploadBackup({file:this.selectedFile});(e.success||e.message)&&(this.showMessage(e.message||"Backup importado correctamente","success"),this.removeFile(),this.dispatchUploadEvent("backup-uploaded",{file:this.selectedFile,response:e}),l())}catch(e){console.error("Error al subir archivo:",e);const t=e instanceof Error?e.message:"Ocurrió un error al subir el archivo";this.showMessage(t,"error")}finally{this.setLoading(!1)}}}dispatchUploadEvent(e,t){const i=new CustomEvent(e,{detail:t,bubbles:!0,cancelable:!0});this.dropzone.dispatchEvent(i)}setLoading(e){this.isLoading=e,this.uploadBtn.disabled=e,e?(this.uploadText.textContent="Subiendo...",this.uploadSpinner.style.display="block"):(this.uploadText.textContent="Importar Backup",this.uploadSpinner.style.display="none")}showMessage(e,t){this.message.textContent=e,this.message.className=`message ${t}`,this.messageContainer.style.display="block",t==="success"&&setTimeout(()=>this.hideMessage(),5e3)}hideMessage(){this.messageContainer.style.display="none"}reset(){this.removeFile()}getSelectedFile(){return this.selectedFile}isUploading(){return this.isLoading}}document.addEventListener("DOMContentLoaded",()=>{new o});
